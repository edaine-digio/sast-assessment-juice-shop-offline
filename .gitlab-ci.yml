# include:
#   - template: Auto-DevOps.gitlab-ci.yml

variables:
  SAST_EXCLUDED_PATHS: "frontend/src/assets/private/**"
  TEST_DISABLED: "true"
  DAST_DISABLED: "true"
  SNYK_TOKEN: "7cdf926f-2c8b-47d3-bbe2-d8bfc41561fd"

default:
  image: node:20

test-snyk:
  stage: test
  script:
    # Install npm, snyk, and snyk-to-html
    - npm install
    - npm install -g npm@latest
    - npm install -g snyk
    - npm install -g snyk-to-html
    # Run snyk help, snyk auth, snyk monitor, snyk test to break build and out report
    - snyk --help
    - snyk auth $SNYK_TOKEN
    - snyk monitor --project-name=$CI_PROJECT_NAME
    - snyk test --json 2>&1 | tee snyk_results.json
    - snyk-to-html -i snyk_results.json -o snyk_results.html
  artifacts:
    when: always
    paths: 
      - snyk_results.html
 
testa-auditjs:
  script:
    - npm install
    - scan:auditjs --json 2>&1 | tee auditjs_results.json
  # Save report to artifacts
  artifacts:
    when: always
    paths: 
      - auditjs_results.json    
 
